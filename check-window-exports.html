<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–ü—Ä–æ–≤–µ—Ä–∫–∞ Window Exports</title>
  <style>
    body {
      font-family: system-ui, -apple-system, sans-serif;
      max-width: 1200px;
      margin: 40px auto;
      padding: 20px;
      background: #f5f5f5;
    }
    .container {
      background: white;
      border-radius: 12px;
      padding: 30px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    h1 {
      color: #1a1a1a;
      margin-bottom: 10px;
    }
    .subtitle {
      color: #666;
      margin-bottom: 30px;
    }
    .result {
      padding: 20px;
      border-radius: 8px;
      margin: 20px 0;
    }
    .success {
      background: #d4edda;
      border: 1px solid #c3e6cb;
      color: #155724;
    }
    .error {
      background: #f8d7da;
      border: 1px solid #f5c6cb;
      color: #721c24;
    }
    .warning {
      background: #fff3cd;
      border: 1px solid #ffeaa7;
      color: #856404;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 20px 0;
    }
    th, td {
      padding: 12px;
      text-align: left;
      border-bottom: 1px solid #e0e0e0;
    }
    th {
      background: #f8f9fa;
      font-weight: 600;
      color: #495057;
    }
    .status {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 600;
    }
    .status.ok {
      background: #d4edda;
      color: #155724;
    }
    .status.missing {
      background: #f8d7da;
      color: #721c24;
    }
    .stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin: 30px 0;
    }
    .stat-card {
      background: #f8f9fa;
      padding: 20px;
      border-radius: 8px;
      text-align: center;
    }
    .stat-value {
      font-size: 36px;
      font-weight: bold;
      margin: 10px 0;
    }
    .stat-label {
      color: #666;
      font-size: 14px;
    }
    button {
      background: #007bff;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 16px;
      font-weight: 600;
    }
    button:hover {
      background: #0056b3;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ Window Exports</h1>
    <p class="subtitle">–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞ –≤—Å–µ—Ö —Ñ—É–Ω–∫—Ü–∏–π –∏–∑ HTML –≤ window</p>
    
    <button onclick="runCheck()">–ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É</button>
    
    <div id="results"></div>
  </div>

  <script>
    // –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Ñ—É–Ω–∫—Ü–∏–π, –∫–æ—Ç–æ—Ä—ã–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –¥–æ—Å—Ç—É–ø–Ω—ã —á–µ—Ä–µ–∑ window
    const REQUIRED_FUNCTIONS = [
      'onClientSelect',
      'changeExpensePeriod',
      'changeIncomePeriod',
      'changeMoneyPeriod',
      'changePeriod',
      'changeReturnPeriod',
      'changeSupplierReturnPeriod',
      'changeTradingPeriod',
      'changeWriteoffPeriod',
      'closeModal',
      'logout',
      'openAddNewProductIncome',
      'openNewClient',
      'openNewClientModal',
      'openNewExpense',
      'openNewProduct',
      'openNewSupplier',
      'saveNewClient',
      'saveNewExpense',
      'saveNewProduct',
      'saveNewSupplier',
      'showSection',
      'submitOperation',
      'switchTradingTab',
      'calculateDiscount',
      'calculateDiscountReverse',
      'filterClients',
      'filterProductsTable',
      'filterSuppliers'
    ];

    function runCheck() {
      const working = [];
      const missing = [];

      REQUIRED_FUNCTIONS.forEach(fn => {
        if (typeof window[fn] === 'function') {
          working.push(fn);
        } else {
          missing.push(fn);
        }
      });

      const total = REQUIRED_FUNCTIONS.length;
      const workingCount = working.length;
      const missingCount = missing.length;
      const percentage = Math.round((workingCount / total) * 100);

      let html = '';

      // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
      html += `
        <div class="stats">
          <div class="stat-card">
            <div class="stat-value" style="color: #28a745;">${workingCount}</div>
            <div class="stat-label">–†–∞–±–æ—Ç–∞–µ—Ç</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" style="color: #dc3545;">${missingCount}</div>
            <div class="stat-label">–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" style="color: #007bff;">${percentage}%</div>
            <div class="stat-label">–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å</div>
          </div>
        </div>
      `;

      // –û–±—â–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
      if (missingCount === 0) {
        html += `
          <div class="result success">
            <h2>‚úÖ –û—Ç–ª–∏—á–Ω–æ! –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã</h2>
            <p>–í—Å–µ ${total} —Ñ—É–Ω–∫—Ü–∏–π –¥–æ—Å—Ç—É–ø–Ω—ã —á–µ—Ä–µ–∑ window –∏ –º–æ–≥—É—Ç –±—ã—Ç—å –≤—ã–∑–≤–∞–Ω—ã –∏–∑ HTML.</p>
          </div>
        `;
      } else if (missingCount < 5) {
        html += `
          <div class="result warning">
            <h2>‚ö†Ô∏è –ü–æ—á—Ç–∏ –≥–æ—Ç–æ–≤–æ</h2>
            <p>–†–∞–±–æ—Ç–∞–µ—Ç ${workingCount} –∏–∑ ${total} —Ñ—É–Ω–∫—Ü–∏–π. –û—Å—Ç–∞–ª–æ—Å—å –¥–æ–±–∞–≤–∏—Ç—å ${missingCount}.</p>
          </div>
        `;
      } else {
        html += `
          <div class="result error">
            <h2>‚ùå –¢—Ä–µ–±—É—é—Ç—Å—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è</h2>
            <p>–†–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ ${workingCount} –∏–∑ ${total} —Ñ—É–Ω–∫—Ü–∏–π. –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç ${missingCount}.</p>
          </div>
        `;
      }

      // –¢–∞–±–ª–∏—Ü–∞ —Å –¥–µ—Ç–∞–ª—è–º–∏
      html += `
        <h3>–î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
        <table>
          <thead>
            <tr>
              <th>–§—É–Ω–∫—Ü–∏—è</th>
              <th>–°—Ç–∞—Ç—É—Å</th>
              <th>–¢–∏–ø</th>
            </tr>
          </thead>
          <tbody>
      `;

      REQUIRED_FUNCTIONS.sort().forEach(fn => {
        const exists = working.includes(fn);
        const type = typeof window[fn];
        html += `
          <tr>
            <td><code>${fn}</code></td>
            <td>
              <span class="status ${exists ? 'ok' : 'missing'}">
                ${exists ? '‚úì –î–æ—Å—Ç—É–ø–Ω–∞' : '‚úó –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç'}
              </span>
            </td>
            <td><code>${type}</code></td>
          </tr>
        `;
      });

      html += `
          </tbody>
        </table>
      `;

      // –ö–æ–Ω—Å–æ–ª—å–Ω—ã–π –≤—ã–≤–æ–¥ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
      console.group('üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ Window Exports');
      console.log(`–†–∞–±–æ—Ç–∞–µ—Ç: ${workingCount}/${total} (${percentage}%)`);
      console.log('‚úÖ –†–∞–±–æ—Ç–∞—é—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏:', working);
      if (missing.length > 0) {
        console.error('‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏:', missing);
      }
      console.groupEnd();

      document.getElementById('results').innerHTML = html;
    }

    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
    window.addEventListener('load', () => {
      setTimeout(runCheck, 500);
    });
  </script>
</body>
</html>
