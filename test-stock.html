<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–¢–µ—Å—Ç –æ—Å—Ç–∞—Ç–∫–æ–≤</title>
  <script type="module">
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm';
    
    const supabase = createClient(
      'YOUR_SUPABASE_URL',
      'YOUR_SUPABASE_ANON_KEY'
    );
    
    async function testStock() {
      const companyId = 'YOUR_COMPANY_ID'; // –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π ID
      
      console.log('üìä –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤...');
      
      const { data, error } = await supabase
        .from('products')
        .select(`
          id, name, sale_price, purchase_price,
          product_balances (quantity, store_location_id, warehouse_id)
        `)
        .eq('company_id', companyId)
        .eq('active', true)
        .limit(5);
      
      if (error) {
        console.error('‚ùå –û—à–∏–±–∫–∞:', error);
        return;
      }
      
      console.log('‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ —Ç–æ–≤–∞—Ä–æ–≤:', data.length);
      
      data.forEach(product => {
        const totalStock = product.product_balances?.reduce((sum, b) => sum + Number(b.quantity), 0) || 0;
        
        console.log(`
üì¶ ${product.name}
   - product_balances: ${product.product_balances?.length || 0} –∑–∞–ø–∏—Å–µ–π
   - –û—Å—Ç–∞—Ç–æ–∫: ${totalStock}
   - –î–µ—Ç–∞–ª–∏:`, product.product_balances);
      });
      
      document.getElementById('result').innerHTML = `
        <h2>–†–µ–∑—É–ª—å—Ç–∞—Ç –∑–∞–≥—Ä—É–∑–∫–∏:</h2>
        <pre>${JSON.stringify(data, null, 2)}</pre>
      `;
    }
    
    window.testStock = testStock;
  </script>
</head>
<body>
  <h1>–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –æ—Å—Ç–∞—Ç–∫–æ–≤</h1>
  <button onclick="testStock()">–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ç–æ–≤–∞—Ä—ã</button>
  <div id="result"></div>
</body>
</html>
